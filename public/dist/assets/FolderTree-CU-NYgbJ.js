import{aZ as P,D as t,I as T,o as M,S as h,K as m,ax as F,M as B,E,bv as Q,F as H,G as N,J as V,L as D,B as b,dJ as p,ao as v,C as y,ac as x,bV as ee,dK as te,ba as J,dN as ne,_ as re,dL as ae,ak as oe,aN as w,aF as $,dM as K,ah as le,l as ce,a0 as ie,ai as ue,U as de,z as L,bu as se,bj as he,av as ge,N as fe,r as Ce,bc as me}from"./index-BedYRc4e.js";import{o as be,E as R,J as we,K as $e}from"./index-BVES88d_.js";const j=p(),A=e=>{var o;const[l,a]=b("/"),[c,n]=b(null),d=()=>{n(l())};return(o=e.handle)==null||o.call(e,{setPath:a,startCreateFolder:d}),t(v,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return t(j.Provider,{get value(){var i,r,u,g;return{value:l,onChange:f=>{a(f),e.onChange(f)},autoOpen:(i=e.autoOpen)!=null?i:!1,forceRoot:(r=e.forceRoot)!=null?r:!1,showEmptyIcon:(u=e.showEmptyIcon)!=null?u:!1,showHiddenFolder:(g=e.showHiddenFolder)!=null?g:!0,creatingFolderPath:c,setCreatingFolderPath:n}},get children(){return t(U,{path:"/"})}})}})},U=e=>{const{isHidePath:l}=ee(),[a,c]=b(),{value:n,onChange:d,forceRoot:o,autoOpen:i,showEmptyIcon:r,showHiddenFolder:u,creatingFolderPath:g,setCreatingFolderPath:f}=te(j),W=()=>{var s;return!!(r&&a()!==void 0&&!((s=a())!=null&&s.length))},[X,G]=J(()=>ne(e.path,re(),o));let I=!1;const k=async(s=!1)=>{var z;if(!s&&((z=a())!=null&&z.length))return;const Z=await G();se(Z,q=>{I=!0,c(q)},()=>{C()&&S()})},{isOpen:C,onToggle:S}=P(),O=()=>n()===e.path,_=ae(e.path);y(oe(n,async s=>{i&&_(s)&&(C()||S(),I||k())})),y(()=>{g()===e.path&&(C()||S(),I||k())});const Y=()=>l(e.path)&&!_(n());return t(h,{get when(){return u||!Y()},get children(){return t(v,{get children(){return[t(F,{spacing:"$2",get children(){return[t(h,{get when(){return!X()},get fallback(){return t(K,{size:"sm",get color(){return $()}})},get children(){return t(h,{get when(){return!W()},get fallback(){return t(w,{get color(){return $()},as:R})},get children(){return t(w,{get color(){return $()},as:be,get transform(){return C()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{S(),C()&&k()}})}})}}),t(le,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return O()?"$info8":"transparent"},get _hover(){return{bgColor:O()?"$info8":ie()}},onClick:()=>{d(e.path)},get children(){return x(()=>e.path==="/")()?"root":ce(e.path)}})]}}),t(h,{get when(){return C()},get children(){return t(ue,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return[t(de,{get each(){return a()},children:s=>t(U,{get path(){return L(e.path,s.name)}})}),t(h,{get when(){return g()===e.path},get children(){return t(ke,{get parentPath(){return e.path},onCancel:()=>f(null),onSuccess:s=>{f(null),d(s),k(!0)}})}})]}})}})]}})}})},Fe=0,ke=e=>{const l=M(),[a,c]=b(""),[n,d]=J(he),o=async()=>{const r=a().trim();if(!r||n())return;const u=fe(r);if(!u.valid){Ce.warning(l("global.".concat(u.error)));return}const g=L(e.parentPath,r),f=await d(g);me(f,()=>{e.onSuccess(g)},()=>{e.onCancel()})};let i;return ge(()=>{setTimeout(()=>{i==null||i.focus(),i==null||i.select()},Fe)}),t(F,{spacing:"$2",w:"$full",pl:"$4",alignItems:"center",get children(){return[t(w,{get color(){return $()},as:R}),t(T,{ref:r=>i=r,get value(){return a()},onInput:r=>c(r.currentTarget.value),get placeholder(){return l("home.toolbar.input_dir_name")},size:"sm",flex:"1",onKeyDown:r=>{r.key==="Enter"?(r.preventDefault(),o()):r.key==="Escape"&&e.onCancel()},onBlur:r=>{if(n())return;const u=r.relatedTarget;(u==null?void 0:u.dataset.folderAction)!=="true"&&(a().trim()||e.onCancel())}}),t(h,{get when(){return!n()},get fallback(){return t(K,{size:"sm",get color(){return $()}})},get children(){return t(m,{get"aria-label"(){return l("global.ok")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$success9",onClick:o,tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:we,boxSize:"$6"})}})}}),t(m,{get"aria-label"(){return l("global.cancel")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$danger9",get onClick(){return e.onCancel},tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:$e,boxSize:"$6"})}})]}})},Ie=e=>{const l=M(),[a,c]=b("/"),[n,d]=b();return y(()=>{var o;e.opened&&((o=n())==null||o.setPath(a()))}),typeof e.defaultValue=="function"?y(()=>{c(e.defaultValue())}):typeof e.defaultValue=="string"&&c(e.defaultValue),t(D,{size:"xl",blockScrollOnMount:!1,get opened(){return e.opened},get onClose(){return e.onClose},get children(){return[t(B,{}),t(E,{get children(){return[t(H,{w:"$full",css:{overflowWrap:"break-word"},get children(){return t(F,{w:"$full",justifyContent:"space-between",alignItems:"center",get children(){return[t(v,{css:{overflowWrap:"break-word"},get children(){return e.header}}),t(h,{get when(){return x(()=>!!e.headerSlot)()&&n()},get children(){return e.headerSlot(n())}})]}})}}),t(N,{get children(){return[x(()=>e.children),t(A,{onChange:c,handle:o=>d(o),autoOpen:!0})]}}),t(V,{display:"flex",w:"$full",gap:"$4",alignItems:"flex-end",justifyContent:"flex-end",get children(){return[t(h,{get when(){return e.footerSlot},get children(){return t(v,{mr:"auto",get children(){return e.footerSlot}})}}),t(F,{spacing:"$2",get children(){return[t(m,{get onClick(){return e.onClose},colorScheme:"neutral",get children(){return l("global.cancel")}}),t(m,{get loading(){return e.loading},onClick:()=>{var o;return(o=e.onSubmit)==null?void 0:o.call(e,a())},get children(){return l("global.ok")}})]}})]}})]}})]}})},xe=e=>{const{isOpen:l,onOpen:a,onClose:c}=P(),n=M();return[t(F,{w:"$full",spacing:"$2",get children(){return[t(T,{get id(){return e.id},get value(){return e.value},onInput:d=>e.onChange(d.currentTarget.value),get readOnly(){return e.onlyFolder},get onClick(){return e.onlyFolder?a:()=>{}},get placeholder(){return n("global.".concat(e.onlyFolder?"choose_folder":"choose_or_input_path"))}}),t(h,{get when(){return!e.onlyFolder},get children(){return t(m,{onClick:a,get children(){return n("global.choose")}})}})]}}),t(D,{size:"xl",get opened(){return l()},onClose:c,get children(){return[t(B,{}),t(E,{get children(){return[t(Q,{}),t(H,{get children(){return n("global.choose_folder")}}),t(N,{get children(){return t(A,{forceRoot:!0,get onChange(){return e.onChange}})}}),t(V,{get children(){return t(m,{onClick:c,get children(){return n("global.confirm")}})}})]}})]}})]};export{A as F,Ie as M,xe as a};
