import{j as fe,am as Oe,ba as ue,eg as Pe,eh as Me,P as y,B as c,C as de,a5 as _,O as Le,ei as b,D as t,a2 as Fe,X as R,Y as z,ac as W,U as ge,a1 as he,S as m,a9 as Ie,aa as q,ab as Ue,ah as v,o as we,ai as T,a8 as Be,aJ as Ee,ad as me,ax as S,bt as Ae,ap as Re,dr as ze,ej as We,bU as p,aN as be,aF as qe,q as Te,cE as De,cQ as Ne,a0 as He,aw as Je,bV as Ve,cH as Xe,aR as Ge,aX as Qe,a6 as Ye,a7 as Ke,_ as D,aU as Ze}from"./index-BedYRc4e.js";import{O as et,g as tt}from"./icon-Cio4bZTR.js";import{L as rt,c as x}from"./List-CMIhHYvq.js";import{d as nt,g as at}from"./index-BVES88d_.js";import{g as it,O as st}from"./File-C_BefpF9.js";import lt from"./Password-Dcen_P_7.js";import{u as ot}from"./helper-BjjtV35e.js";import{b as ct,x as N,w as ut}from"./style-CBs9wRvG.js";import"./Layout-vp6gmL09.js";import"./useTitle-CsmRnqUX.js";import"./FolderTree-CU-NYgbJ.js";import"./index-bk4w34UW.js";import"./index-Cf8uYi8C.js";import"./share-C1H8r1Qr.js";import"./index-BtqNHVQH.js";import"./storage-BWbNxF5o.js";function dt(){let a=!1,s=[];return{acquire:()=>new Promise(u=>{a?s.push(u):(a=!0,u())}),release:()=>{s.length>0?s.shift()():a=!1}}}const gt=a=>{window.open(a,"_blank")},ht=a=>{const{show:s}=ct({id:2}),{isMouseSupported:u}=ot(),i=()=>Te.list_item_filename_overflow;return t(Je.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return t(S,{class:"list-item viselect-item",get"data-index"(){return a.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:He()}},get cursor(){return u()?"default":"pointer"},"on:click":f=>{a.obj.is_dir?a.jumpCallback():!a.obj.is_dir&&a.onFileClick&&a.onFileClick()},onContextMenu:f=>{s(f,{props:a})},get children(){return[t(S,{class:"name-box",spacing:"$1",get w(){return x[0].w},get children(){return[t(be,{class:"icon",boxSize:"$6",get color(){return qe()},get as(){return tt(a.obj)},mr:"$1"}),t(v,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:i()==="multi_line"?"unset":"nowrap","overflow-x":i()==="scrollable"?"auto":"hidden",textOverflow:i()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return a.obj.name},get children(){return a.obj.name}})]}}),t(v,{class:"size",get w(){return x[1].w},get textAlign(){return x[1].textAlign},get children(){return De(a.obj.size)}}),t(v,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return x[2].w},get textAlign(){return x[2].textAlign},get children(){return Ne(a.obj.modified)}})]}})}})},H={extract:{icon:at,color:"$success9"},copy_link:{icon:nt,color:"$info9"},download:{icon:Ze,color:"$primary9"}},mt=()=>{const{copy:a}=Ve(),{colorMode:s}=Xe(),{isShare:u}=fe();return t(ut,{id:2,animation:"scale",get theme(){return s()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[t(N,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{gt(i.url)},get children(){return t(J,{name:"download"})}}),t(N,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{a(i.url)},get children(){return t(J,{name:"copy_link"})}}),t(N,{hidden:()=>{const i=Qe.findIndex(f=>f==="decompress");return!u()&&!Ye.can(Ke(),i)},onClick:({props:i})=>{Ge.emit("extract",JSON.stringify({inner:i.innerPath,pass:i.pass}))},get children(){return t(J,{name:"extract"})}})]}})},J=a=>{const s=we();return t(S,{spacing:"$2",get children(){return[t(be,{get p(){return H[a.name].p?"$1":void 0},get as(){return H[a.name].icon},boxSize:"$7",get color(){return H[a.name].color}}),t(v,{get children(){return s("home.toolbar.".concat(a.name))}})]}})},Lt=()=>{const a=we(),{pathname:s}=fe(),{rawLink:u}=Oe(),[i,f]=ue(Pe),[pe,V]=ue(Me),ve=y(()=>i()||pe());let d="",X="",G="",k=null;const[O,j]=c(""),[_e,Q]=c(!1),[P,M]=c(!1),[Y,xe]=c(""),[o,L]=c([]),[F,K]=c(),[ke,Z]=c(!1),[je,ee]=c(""),[g,te]=c(""),[re,ne]=c(""),h=dt(),$=e=>{let n={};return e.forEach(r=>{n[r.name]={...r,children:r.children?$(r.children):null}}),n},I=e=>e.code===200?!1:(e.code===202?p(()=>{d!==""&&Q(!0),M(!0),j("")}):j(e.message),!0),ae=async e=>{if(await h.acquire(),P()&&d==="")return h.release(),[];if(X===""){const r=await f(s(),D(),d);if(I(r))return h.release(),[];if(r.data.content!==null&&(k=$(r.data.content)),X=r.data.raw_url,G=r.data.sign,xe(r.data.comment),r.data.sort!==void 0){let l;r.data.sort.order_by!==""&&(l=r.data.sort.order_by);let w=r.data.sort.order_direction==="desc",Se=r.data.sort.extract_folder;p(()=>{K(l),Z(w),ee(Se)})}if(r.data.encrypted&&d==="")return p(()=>{M(!0),j("")}),h.release(),[]}if(k===null){const r=await V(s(),D(),d,"/");if(I(r))return h.release(),[];k=$(r.data.content)}let n=k;for(let r=0;r<e.length;r++){if(n[e[r]].children===null){const l=await V(s(),D(),d,"/"+e.slice(0,r+1).join("/"));if(I(l))return h.release(),[];n[e[r]].children=$(l.data.content)}n=n[e[r]].children}return p(()=>{M(!1),Q(!1),j("")}),h.release(),Object.values(n)},[$e,ie]=c([]);de(()=>{ae(o()).then(e=>ie(e))});const se=()=>{ae(o()).then(e=>ie(e))};se();const le=()=>{let e=$e();F()&&(e=e.sort((r,l)=>(ke()?-1:1)*We(r[F()],l[F()])));let n=je();if(n!==""){let r=[],l=[];e.forEach(w=>(w.is_dir?r:l).push(w)),e=n==="front"?r.concat(l):l.concat(r)}return e},Ce=e=>(o().length>0?"/"+o().join("/"):"")+"/"+e,oe=e=>{const n=o().length>0?"/"+o().join("/"):"";return{...e,sign:G,inner_path:n,archive:A}},ye=(e,n)=>{p(()=>{ee(""),K(e),n!==void 0&&Z(n)})},U=y(()=>le().filter(e=>!e.is_dir).map(e=>oe(e))),B=y(()=>{const e=U().find(n=>n.name===g());return e?it({...e,provider:_.provider}):[]}),E=y(()=>{const e=B();if(e.length===0)return null;if(re()){const n=e.find(r=>r.name===re());if(n)return n}return e[0]}),A={..._.obj,inner_path:void 0,archive:void 0},ce=_.raw_url,C=e=>{p(()=>{if(e==="")b.setObj(A),b.setRawUrl(ce),te("");else{const n=U().find(r=>r.name===e);if(n){const r=u(n);b.setObj(n),b.setRawUrl(r),te(e)}}})};return Le(()=>{b.setObj(A),b.setRawUrl(ce)}),de(()=>{g(),ne("")}),t(T,{spacing:"$2",w:"$full",get children(){return[t(Fe,{pl:"$2",pr:"$2",w:"$full",get children(){return[t(R,{get children(){return t(z,{get currentPage(){return W(()=>o().length===0)()&&!g()},"on:click":()=>{L([]),C("")},children:"."})}}),t(ge,{get each(){return o()},children:(e,n)=>t(R,{get children(){return[t(he,{}),t(z,{get currentPage(){return W(()=>o().length===n()+1)()&&!g()},"on:click":()=>{L(o().slice(0,n()+1)),C("")},children:e})]}})}),t(m,{get when(){return g()},get children(){return t(R,{get children(){return[t(he,{}),t(z,{currentPage:!0,get children(){return g()}})]}})}})]}}),t(Ie,{get children(){return[t(q,{get when(){return O()!==""},get children(){return t(Ue,{get msg(){return O()},disableColor:!0})}}),t(q,{get when(){return P()},get children(){return t(lt,{get title(){return a("home.toolbar.archive.input_password")},password:()=>d,setPassword:e=>d=e,enterCallback:()=>se(),get children(){return t(m,{get when(){return _e()},get children(){return t(v,{color:"$danger9",get children(){return a("home.toolbar.archive.incorrect_password")}})}})}})}}),t(q,{get when(){return W(()=>!P())()&&O()===""},get children(){return t(m,{get when(){return g()},get fallback(){return t(Re,{get loading(){return ve()},get children(){return t(T,{class:"list",w:"$full",spacing:"$1",get children(){return[t(rt,{sortCallback:ye,disableCheckbox:!0}),t(ge,{get each(){return le()},children:(e,n)=>{const r=oe(e);let l=e.is_dir?void 0:u(r),w=Ce(e.name);return t(ht,{obj:e,get index(){return n()},jumpCallback:()=>L(o().concat(e.name)),innerPath:w,url:l,pass:d,onFileClick:()=>C(e.name)})}}),t(mt,{})]}})}})},get children(){return t(m,{get when(){return g()},get fallback(){return t(me,{})},get children(){return t(T,{w:"$full",spacing:"$2",alignItems:"center",get children(){return[t(m,{get when(){return E()},get children(){return t(Be,{get fallback(){return t(me,{})},get children(){return t(Ee,{get component(){var e;return(e=E())==null?void 0:e.component},get images(){return U().filter(e=>e.type===et.IMAGE)},navigate:e=>{C(e)}})}})}}),t(S,{w:"$full",justifyContent:"center",spacing:"$2",p:"$2",get children(){return[t(m,{get when(){return B().length>1},get children(){return t(Ae,{get value(){var e;return((e=E())==null?void 0:e.name)||""},onChange:e=>ne(String(e)),get options(){return B().map(e=>({value:e.name,label:e.name}))}})}}),t(st,{get file(){return{name:g(),raw_url:_.raw_url,d_url:_.raw_url}}})]}})]}})}})}})}})]}}),t(m,{get when(){return Y()!==""},get children(){return[t(ze,{}),t(v,{w:"$full",pl:"$1",pr:"$1",get children(){return Y()}})]}})]}})};export{Lt as default};
